{{extend 'layout.html'}}

<html>
<h4> Example of path drawn using json geo data, with two svg following path.
<br> Turn path on by changing editing twosvg.html and adding stroke file value to 1. </h4>
<h6> References<br>
<a href="https://github.com/mbostock/d3/wiki/API-Reference"> Bostock D3.js API reference /</a>
<a href="http://www.dashingd3js.com/svg-paths-and-d3js"> figuring out how to use svg path /</a><br>
<a href="http://bl.ocks.org/duopixel/3824661">this uses random line path / </a>
<a href="www.picgifs.com/graphics/butterflies">similar butterfly gif found here./</a>
<a href="http://stackoverflow.com/questions/14275249/how-can-i-animate-a-progressive-drawing-of-svg-path/14282391#14282391">Gavin Kistner </a>
</h6>

{{=SCRIPT(_type="text/javascript", _src=URL(c="static", f="dygraphjs/d3.v3.js"))}}
{{=SCRIPT(_type="text/javascript", _src=URL(c="static", f="dygraphjs/dygraph-dev.js"))}}
{{=SCRIPT(_type="text/javascript", _src=URL(c="static", f="jquery-ui-1.10.3/jquery-1.9.1.js"))}}

<body>
<script type="text/javascript">

// Draw a GeoJSON line on the map:
$(document).ready(function () {

    var json, map,
    path, vis, xy,
    duration, offset, origin_x, origin_y, len, group, rect;

    json = {
        "type": "FeatureCollection",
            "features": [{
            "type": "Feature",
                "geometry": {
                "type": "LineString",
                    "coordinates": [
	    [-75.194946527,
	    43.093336741,
		"138.2"],
	    [-75.194946527,
	    43.093336741,
		"138.2"],
	    [-75.195343494,
	    43.09307428,
		"139.8"],
	    [-75.195794106,
	    43.092815735,
		"140.7"],
	    [-75.196196437,
	    43.092298642,
		"142.0"],
	    [-75.196588039,
	    43.091801132,
		"143.0"],
	    [-75.197113752,
	    43.091190011,
		"143.2"],
	    [-75.200815201,
	    43.086661261,
		"152.0"],
	    [-75.202842951,
	    43.084130343,
		"161.1"],
	    [-75.205750465,
	    43.08062763,
		"158.5"],
	    [-75.206329823,
	    43.079945871,
		"159.8"],
	    [-75.207724571,
	    43.078268868,
		"162.8"],
	    [-75.208051801,
	    43.077927976,
		"163.0"],
	    [-75.208357573,
	    43.077653694,
		"163.6"],
	    [-75.20884037,
	    43.077304962,
		"164.8"],
	    [-75.209312439,
	    43.077046351,
		"165.0"],
	    [-75.20994544,
	    43.076779901,
		"165.3"],
	    [-75.210567713,
	    43.076591819,
		"166.5"],
	    [-75.211597681,
	    43.076325367,
		"167.7"],
	    [-75.212370157,
	    43.076113773,
		"168.0"],
	    [-75.212874413,
	    43.075910015,
		"168.5"],
	    [-75.213335752,
	    43.075667071,
		"170.6"],
	    [-75.213780999,
	    43.075361431,
		"171.0"],
	    [-75.214156508,
	    43.075032279,
		"171.9"],
	    [-75.214553475,
	    43.074620835,
		"173.4"],
	    [-75.215063095,
	    43.074138856,
		"174.0"],
	    [-75.215610266,
	    43.073770511,
		"175.6"],
	    [-75.216264725,
	    43.073394327,
		"177.0"],
	    [-75.217251778,
	    43.072931931,
		"179.4"],
	    [-75.217552185,
	    43.072833965,
		"179.8"],
	    [-75.217938423,
	    43.072751673,
		"180.0"],
	    [-75.218378305,
	    43.07270465,
		"180.0"],
	    [-75.218818188,
	    43.072720324,
		"180.0"],
	    [-75.21925807,
	    43.072771267,
		"180.0"],
	    [-75.219687223,
	    43.07287707,
		"180.0"],
	    [-75.220116377,
	    43.073045571,
		"180.0"],
	    [-75.220518708,
	    43.073261094,
		"179.9"],
	    [-75.220974684,
	    43.073504047,
		"179.0"],
	    [-75.221409202,
	    43.073782267,
		"179.0"],
	    [-75.222069025,
	    43.074264249,
		"179.0"],
	    [-75.223088264,
	    43.075114567,
		"178.1"],
	    [-75.223925114,
	    43.075800298,
		"177.1"],
	    [-75.224847794,
	    43.076576145,
		"176.6"],
	    [-75.225684643,
	    43.077257942,
		"176.9"],
	    [-75.226199627,
	    43.077610592,
		"176.7"],
	    [-75.226714611,
	    43.077947568,
		"176.5"],
	    [-75.227240324,
	    43.078233603,
		"176.4"],
	    [-75.227723122,
	    43.078464782,
		"176.3"],
	    [-75.228248835,
	    43.07869596,
		"176.5"],
	    [-75.228956938,
	    43.078958482,
		"176.8"],
	    [-75.229525566,
	    43.079134803,
		"177.1"],
	    [-75.230340958,
	    43.079256268,
		"177.9"],
	    [-75.231038332,
	    43.079444342,
		"179.7"],
	    [-75.231955647,
	    43.079675516,
		"181.2"],
	    [-75.232647657,
	    43.079851835,
		"181.5"],
	    [-75.232765675,
	    43.079847917,
		"181.5"],
	    [-75.232867599,
	    43.079765635,
		"182.2"],
	    [-75.234074593,
	    43.078268868,
		"196.9"],
	    [-75.235351324,
	    43.076725044,
		"204.4"],
	    [-75.236274004,
	    43.07562005,
		"203.0"],
	    [-75.237110853,
	    43.074612998,
		"200.7"],
	    [-75.238012075,
	    43.073558908,
		"203.0"],
	    [-75.238859653,
	    43.072551823,
		"208.9"],
	    [-75.238972306,
	    43.072532229,
		"209.4"],
	    [-75.239278078,
	    43.072583172,
		"211.3"],
	    [-75.239530206,
	    43.072598846,
		"212.7"],
	    [-75.239798427,
	    43.072563578,
		"213.3"],
	    [-75.240050554,
	    43.07250088,
		"213.2"],
	    [-75.240404606,
	    43.07241467,
		"213.5"],
	    [-75.240801573,
	    43.072351971,
		"213.9"],
	    [-75.241488218,
	    43.072254004,
		"214.2"],
	    [-75.242174864,
	    43.072234411,
		"214.1"],
	    [-75.242604017,
	    43.072234411,
		"214.1"],
	    [-75.243097544,
	    43.072273598,
		"214.4"],
	    [-75.243580341,
	    43.072391158,
		"215.2"],
	    [-75.243982673,
	    43.072622358,
		"217.9"],
	    [-75.244315267,
	    43.072869232,
		"219.7"],
	    [-75.244503021,
	    43.073049489,
		"220.8"],
	    [-75.244594216,
	    43.073284606,
		"221.7"],
	    [-75.244497657,
	    43.073464861,
		"222.9"],
	    [-75.244363546,
	    43.073590256,
		"223.9"],
	    [-75.24400413,
	    43.073727407,
		"225.4"],
	    [-75.24359107,
	    43.073841045,
		"225.8"],
	    [-75.243194103,
	    43.073978195,
		"226.6"],
	    [-75.242893696,
	    43.074123182,
		"227.7"],
	    [-75.242518187,
	    43.074358294,
		"228.7"],
	    [-75.242271423,
	    43.074546384,
		"229.4"],
	    [-75.241954923,
	    43.074859865,
		"229.5"],
	    [-75.241852999,
	    43.075138078,
		"230.2"],
	    [-75.241869092,
	    43.075353594,
		"231.0"],
	    [-75.24184227,
	    43.07562005,
		"231.9"],
	    [-75.241783261,
	    43.07592177,
		"233.5"],
	    [-75.241633058,
	    43.076004057,
		"233.6"],
	    [-75.241144896,
	    43.076019731,
		"233.3"],
	    [-75.240731835,
	    43.076019731,
		"233.6"],
	    [-75.240291953,
	    43.076078507,
		"233.6"],
	    [-75.239943266,
	    43.076168631,
		"233.2"],
	    [-75.239669681,
	    43.076290102,
		"232.5"],
	    [-75.239481926,
	    43.076427246,
		"232.2"],
	    [-75.239176154,
	    43.076681942,
		"230.1"],
	    [-75.23889184,
	    43.076873942,
		"228.8"],
	    [-75.238645077,
	    43.07699933,
		"227.4"],
	    [-75.238264203,
	    43.077222677,
		"226.5"],
	    [-75.238044262,
	    43.077379411,
		"224.9"],
	    [-75.237754583,
	    43.077493042,
		"222.9"],
	    [-75.237454176,
	    43.077579246,
		"221.4"],
	    [-75.237196684,
	    43.077712469,
		"219.1"],
	    [-75.236939192,
	    43.077912303,
		"217.5"],
	    [-75.236778259,
	    43.078108218,
		"216.0"],
	    [-75.236649513,
	    43.078386416,
		"213.6"],
	    [-75.236595869,
	    43.078692041,
		"211.2"],
	    [-75.236601233,
	    43.079009419,
		"209.2"],
	    [-75.236687064,
	    43.079318959,
		"208.0"],
	    [-75.236869454,
	    43.079699025,
		"205.0"],
	    [-75.237132311,
	    43.080161371,
		"202.1"],
	    [-75.237427354,
	    43.080568858,
		"199.6"],
	    [-75.237658024,
	    43.080894063,
		"196.3"],
	    [-75.237856507,
	    43.081113477,
		"194.3"],
	    [-75.238119364,
	    43.081372072,
		"193.4"],
	    [-75.23861289,
	    43.081669845,
		"192.9"],
	    [-75.240994692,
	    43.082665027,
		"189.1"],
	    [-75.244578123,
	    43.08415385,
		"175.2"],
	    [-75.246326923,
	    43.084819891,
		"171.4"],
	    [-75.248183012,
	    43.085470254,
		"167.3"],
	    [-75.250639915,
	    43.086355676,
		"165.1"],
	    [-75.251787901,
	    43.086849313,
		"164.0"],
	    [-75.252796412,
	    43.087276344,
		"162.8"],
	    [-75.253676176,
	    43.087734715,
		"162.0"],
	    [-75.25511384,
	    43.088459481,
		"160.0"],
	    [-75.256272554,
	    43.089090217,
		"158.3"],
	    [-75.258644,
	    43.08794,
		"158.4"],
	    [-75.260054,
	    43.089515,
		"155.7"],
	    [-75.258459,
	    43.090334,
		"154.9"],
	    [-75.258439779,
	    43.090343834,
		"154.9"],
	    [-75.260242224,
	    43.091182176,
		"152.7"],
	    [-75.261529684,
	    43.09177371,
		"149.8"],
	    [-75.262141228,
	    43.092020507,
		"146.2"],
	    [-75.262870789,
	    43.092232046,
		"145.0"],
	    [-75.263460875,
	    43.092365238,
		"145.2"],
	    [-75.264115334,
	    43.092474924,
		"148.5"],
	    [-75.26483953,
	    43.092565024,
		"152.8"],
	    [-75.265499353,
	    43.092608115,
		"154.3"],
	    [-75.266202092,
	    43.092608115,
		"155.1"],
	    [-75.2673769,
	    43.092561107,
		"155.2"],
	    [-75.268696547,
	    43.092506263,
		"156.0"],
	    [-75.269249082,
	    43.092514098,
		"156.1"],
	    [-75.269790888,
	    43.092568941,
		"157.2"],
	    [-75.270370245,
	    43.092666875,
		"157.8"],
	    [-75.270949602,
	    43.092819652,
		"159.2"],
	    [-75.271657705,
	    43.093039024,
		"161.9"],
	    [-75.272387266,
	    43.093285816,
		"164.8"],
	    [-75.273299217,
	    43.09357178,
		"167.8"],
	    [-75.274023414,
	    43.093740224,
		"168.7"],
	    [-75.27469933,
	    43.093857743,
		"170.0"],
	    [-75.274999738,
	    43.09394784,
		"171.0"],
	    [-75.275107026,
	    43.094108449,
		"171.3"],
	    [-75.275005102,
	    43.094288643,
		"171.0"],
	    [-75.274490118,
	    43.094942822,
		"171.1"],
	    [-75.274216533,
	    43.095416804,
		"171.6"],
	    [-75.27410388,
	    43.095718427,
		"171.9"],
	    [-75.274018049,
	    43.096133645,
		"172.0"],
	    [-75.274018049,
	    43.096447016,
		"172.5"],
	    [-75.274093151,
	    43.09683481,
		"172.9"],
	    [-75.274211168,
	    43.097112923,
		"173.1"],
	    [-75.274420381,
	    43.097496796,
		"173.9"],
	    [-75.274640322,
	    43.097794491,
		"174.0"],
	    [-75.275037289,
	    43.098280202,
		"175.0"],
	    [-75.275225043,
	    43.098585728,
		"175.7"],
	    [-75.275294781,
	    43.098812912,
		"176.0"],
	    [-75.275321603,
	    43.099192857,
		"175.1"],
	    [-75.275273323,
	    43.099517963,
		"174.7"],
	    [-75.275123119,
	    43.09989007,
		"173.7"],
	    [-75.27493,
	    43.100176003,
		"172.3"],
	    [-75.274356008,
	    43.100877122,
		"169.7"],
	    [-75.27382493,
	    43.101558648,
		"167.2"],
	    [-75.27235508,
	    43.103395598,
		"160.5"],
	    [-75.270777941,
	    43.10531474,
		"152.7"],
	    [-75.269072056,
	    43.107429644,
		"147.3"],
	    [-75.267870426,
	    43.108870869,
		"143.1"],
	    [-75.266582966,
	    43.110460878,
		"136.6"],
	    [-75.265552998,
	    43.111659231,
		"132.0"],
	    [-75.265445709,
	    43.111757135,
		"131.9"],
	    [-75.265290141,
	    43.111725806,
		"131.8"],
	    [-75.264678597,
	    43.111479088,
		"132.6"],
	    [-75.263214111,
	    43.110797672,
		"133.1"],
	    [-75.261701345,
	    43.109928269,
		"136.3"],
	    [-75.261154175,
	    43.109630632,
		"138.2"],
	    [-75.260338783,
	    43.109426985,
		"138.1"],
	    [-75.25940001,
	    43.109164593,
		"139.0"],
	    [-75.258386135,
	    43.108863037,
		"139.1"],
	    [-75.257002115,
	    43.108408741,
		"139.0"],
	    [-75.255355239,
	    43.107825201,
		"141.8"],
	    [-75.254051685,
	    43.107366981,
		"143.5"],
	    [-75.252989531,
	    43.106991003,
		"143.8"],
	    [-75.252174139,
	    43.106513194,
		"143.5"],
	    [-75.25133729,
	    43.106047132,
		"143.2"],
	    [-75.250613093,
	    43.105639813,
		"143.7"],
	    [-75.250071287,
	    43.105330406,
		"143.1"],
	    [-75.249223709,
	    43.104711587,
		"138.4"],
	    [-75.248832107,
	    43.104410009,
		"137.0"],
	    [-75.248451233,
	    43.104163262,
		"136.4"],
	    [-75.247673392,
	    43.103889097,
		"135.6"],
	    [-75.246949196,
	    43.103607098,
		"134.0"],
	    [-75.246251822,
	    43.103395598,
		"133.9"],
	    [-75.245372057,
	    43.103176263,
		"133.0"],
	    [-75.194946527,
	    43.093336741,
		"138.2"]
                ]
            }
        }]
    };

    map = $('#map');
    xy = d3.geo.mercator().scale(480000).translate([630700, 401100]);
    path = d3.geo.path().projection(xy);

    vis = d3.select("#map")
        .append("svg:svg")
        .attr("width", 960)
        .attr("height", 600);

    vis.append("svg:g")
        .attr("class", "route")
        .selectAll("path")
        .data(json.features)
        .enter()
        .append("svg:path")
        .attr("d", path)
        //.attr("fill-opacity", 0.5)
        .attr("fill", "#fff");
        //.attr("stroke", "#999");


    // Draw a red rect on the map:


    group = vis.append("svg:g");
    
    var targetPath = d3.selectAll('.route')[0][0];
    var pathNode = d3.select(targetPath).selectAll('path').node();
    var pathLength = pathNode.getTotalLength();

// draw image on map

            var img1 = group.append("svg:image")
            .attr({
             "xlink:href": "{{=URL('static','images/butterfly.gif')}}" ,
              "x": "30",
               "y": "30",
               "width": "30",
               "height": "30",
                transform: function () {
            var p = pathNode.getPointAtLength(0)
            return "translate(" + [p.x, p.y] + ")";
        }
    });

    // Draw a red rect on the map:
    var rect = group.append("rect")
        .attr({
	"x": 10,
        "y": 10,
        "height": 10,
        "width": 10,
        fill: '#f33',
        transform: function () {
            var p = pathNode.getPointAtLength(0)
            return "translate(" + [p.x, p.y] + ")";
        }
    });

    // Animate the rect and image:

    duration = 10700;
    //rect.transition()
    img1.transition()
        .duration(duration)
        .ease("linear")
        .attrTween("transform", function (d, i) {
        return function (t) {
            //var p = pathNode.getPointAtLength(pathLength*(0.5*t));
            var p = pathNode.getPointAtLength(pathLength*(0.99*t));
            return "translate(" + [p.x, p.y] + ")";
        }
    });

    duration = 10000;
    rect.transition()
        .duration(duration)
        .ease("linear")
        .attrTween("transform", function (d, i) {
        return function (t) {
            var p = pathNode.getPointAtLength(pathLength*t);
            return "translate(" + [p.x, p.y] + ")";
        }
    });

});

</script>

</body>
<div id="map"></div>
</html>
