{{extend 'layout.html'}}

<head>
    <style>
        .button {
            background-color: #000000;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
    </style>
</head>

<body style="background-color:#DCDCDC;">
    
<a href="{{=URL('default', 'index')}}" class="button">Home Page</a>

{{=SCRIPT(_type="text/javascript", _src=URL(c="static", f="js/d3.v3.js"))}}

<!-- Change the title below: REQUIRED-->
    
    <!--<h1 style = "color:#3030FF"><bold>Rock Paper Scissors</bold></h1>-->
    <img src = 'http://rockpaperscissorshair.co.uk/img/logo-x2.png' style = "width:400px;height:200px;position:relative;left:200px">
    <!-- Your D3.js code for making a Bar Graph -->
<script type="text/javascript">

var wins = 0;
var lose = 0;

//sorry the indentation is so bad, i will fix it later with a change in editor

/*Node in a doubly-linked list that stores player choice and the result.
Logging is the same format used elsewhere: -1 for tie, 0 for loss, 1 for
win. */
function gameNode(choice, result){
  this.choice = choice; this.result = result;
  this.prev = null; this.next = null;
}

/*The doubly-linked list structure itself.  The limit specifies how much can
be stored before it begins to throw itself away. This is gong to be used for
database storing and for training higher-level bots.*/
function gameNodeList(limit){
  this.limit = limit; this.wins = 0; this.losses = 0; this.draws = 0;
  this.head = null; this.tail = null;
  if (this.limit <= 0) this.limitless = true;
		    else this.limitless = false;

  //wins, losses, draws
  this.rockData = [0, 0, 0];
  this.paperData = [0, 0, 0];
  this.scissorsData = [0, 0, 0];
  this.winData = [this.rockData, this.paperData, this.scissorsData];
}
		    
//svg wrapper that holds the squares
var board = d3.select("body").append("svg")
    .attr("width", 1300)
    .attr("height", 150)
	.style("display", "block")
    .append("g")
	.attr("transform", "translate(25, 25)");

/*
//object that holds the values specific for each rectangle
//Used to feed into the .selectAll in next line
//replace colored rect options with rock, paper, scissor images
// OLD CODE REPLACED BY CODE BELOW THAT USES RPS IMAGES INSTEAD OF RECTS
var choices = [{color: "red", value: 0, transform: "translate(0,0)", stroke: 'none'},
			   {color: "black", value: 1, transform: "translate(150,0)", stroke: 'none'},
			   {color: "blue", value: 2, transform: "translate(300,0)", stroke: 'none'}];
*/

// object that holds the values/images for each RPS option
// used to feed into teh .selectAll in the next line
var images = [{value: 0, link: "https://img.clipartfest.com/201616f9cdd7deb314215b1be524d2a2_clipart-alpine-landscape-rock-rock-clipart_800-534.png", transform: "translate(0,0)" },
              {value: 1, link: "https://www.rocknwater.com/wp-content/uploads/icon-paper-document-fold-redirect-pdf.png", transform: "translate(150,0)"},
              {value: 2, link: "http://www.clipartbest.com/cliparts/KTn/Xj6/KTnXj6Mgc.png", transform: "translate(300,0)"}];
    
board.selectAll(("image")).data(images).enter()
    .append(("image"))
    .attr("xlink:href", function(d){return d.link})
    .attr("width", 100)
    .attr("height", 100)
    .attr('transform', function(d){return d.transform})
	.on("mouseover", mouseHover)
	.on("mouseout", mouseOut)
	.on("click", click);   
    
    
board.append('rect')
	.attr('width', '180')
	.attr('height', '120')
	.attr('fill', 'none')
	.attr('stroke', 'green')
	.attr('stroke-width', '2')
	.attr("transform", "translate(800,0)");
   
// place icon for user level
board.append("svg:image")
    .attr("xlink:href", "http://www.aapexshow.com/2017//custom/images/bronze.png")
    .attr("width", 100)
    .attr("height", 100)
    .attr("x", 870)
    .attr("y",10);
    
//Text that displays the user level
board.append("text")	
    .text("Your level: ")
	.attr("font-size", "10")
	.attr("transform", "translate(810, 65)")
	.classed("level", true);
/*
//Enters the data in 'items' each into their own rectangle
//Each line beyond enter() is executed once for each data point (so three times)
board.selectAll('.rect').data(choices).enter()
	.append('rect')
	.attr('width', '50')
	.attr('height', '50')
	.attr('stroke', 'black')
	.attr('fill', 'white')
	.attr('transform', function(d){return d.transform})
	.on("mouseover", mouseHover2)
	.on("mouseout", mouseOut2)
	.on("click", click);
*/

//Svg wrapper to hold the square box. 
var score = d3.select("body").append("svg")
    .attr("width", 1300)
    .attr("height", 100)
	.attr("transform", "translate(25,25)")
	.style("display", "block")
    .append("g");

//rectangle border around the svg
score.append('rect')
	.attr('width', '1005')
	.attr('height', '80')
	.attr('fill', 'none')
	.attr('stroke', 'black')
	.attr('stroke-width', '2')
	.attr("transform", "translate(0,0)");

//Text that holds wins
score.append("text")
	.text("Wins: ")
	.attr("font-size", "20")
    .attr("stroke", "red")
    .attr("fill", "red")
	.attr("transform", "translate(5,17)")
	.classed("wins", true);

//Text that holds losses
score.append("text")
	.text("Losses: ")
	.attr("font-size", "20")
    .attr("stroke", "blue")
    .attr("fill", "blue")
	.attr("transform", "translate(5,45)")
	.classed("loss", true);

//Text that holds the status text
score.append("text")
	.text("Status: ")
	.attr("font-size", "20")
    .attr("fill", "purple")
    .attr("stroke", "purple")
	.attr("transform", "translate(5,73)")
	.classed("status", true);

//Text that holds the user choice text
score.append("text")
	.text("You chose: ")
	.attr("font-size", "10")
	.attr("transform", "translate(520,17)")
	.classed("you", true);

//Text that holds the computer choice text
score.append("text")
	.text("Computer chose: ")
	.attr("font-size", "10")
	.attr("transform", "translate(670,17)")
	.classed("computer", true);

//Text that holds the outcome text
score.append("text")
    .text("")
    .attr("font-size", "12")
    .attr("stroke", "green")
    .attr("fill", "green")
    .attr('stroke-width', '.5')
	.attr("transform", "translate(520,50)")  
    .classed("outcome", true);
    
var levelInfo = ['bronze', 'silver', 'gold', 'platinum'];
var valueInfo = ['0','4','8','12'];
var transInfo = ["translate(855,10)", "translate(855,30)", "translate(855,50)", "translate(855,70)"];
    
for (i = 0; i < 4; i++) {
    score.append("text")	
        .text(levelInfo[i] + ": " +valueInfo[i] + " or more wins")
        .attr("font-size", "10")
        .attr("transform", transInfo[i])
        .classed("level", true);  
}
    
/**
USE THE NEXT THREE LINES AS EXAMPLES FOR HOW TO DYNAMICALLY EDIT THE HTML
*/
//example code that sets the wins to 0 at init
d3.selectAll('.wins')
	.text("Wins: " + 0);

//example code that sets loss to 0 at init.
d3.selectAll('.loss')
	.text("Losses: " + 0);

d3.selectAll('.status')
	.text("Status: Have fun!");

d3.selectAll('.you')
    .text("You chose:");

d3.selectAll('.computer')
    .text("Computer chose:");

//Extra little sg that holds the rules
d3.select("body").append("svg")
    .attr("width", 400)
    .attr("height", 50);
    
d3.select("body").append("p").text("Rules:");

d3.select("body").append("p").text("Rock beats Scissor");

d3.select("body").append("p").text("Scissor beats Paper");

d3.select("body").append("p").text("Paper beats Rock");

console.log(d3.selectAll('.rect'));


//on click function that is used for each square
function click() {
    
	userChoice = d3.select(this).datum().value; // user choice
	compChoice = computerChoice(); // computer choice 
    
	// determine outcome and save result as a numeric value that can be further interpretted 
	chickenDinner = winner(userChoice, compChoice);
	
	console.log(chickenDinner);
    // Tie
	if(chickenDinner < 0) {
        d3.selectAll('.status').text("Status: Tie!");
        d3.selectAll('.outcome').text("It's a tie!");
    }
	
    var losePhrases = ["Dangit, I lost!", "Wow, you beat me!", "I'll win next time!", "You're good at this game!", "Hmm, I should try something else!", "How do you keep winning?", "You got me again!", "Man, I'm losing!"];
    var winPhrases = ["HA, I won!", "Gotcha!", "Better luck next time!", "Dude, you suck!", "Whoa, I'm pretty good!", "C'mon, choose something else!", "Man, do you even play?", "Yes, I won again!"];

    // User Loses
	if(chickenDinner == 0){
		console.log(lose);
		lose = lose + 1;
		d3.selectAll('.status').text("Status: You lose!");
		d3.selectAll('.loss').text("Losses: " + lose);
		console.log(lose);
        d3.selectAll('.outcome').text("Computer Says: " + winPhrases[Math.floor(8 * Math.random())]);
	}
    
    // User Wins
	if(chickenDinner == 1){
		wins = wins + 1;
		d3.selectAll('.status').text("Status: You win!");
		d3.selectAll('.wins').text("Wins: " + wins);
        d3.selectAll('.outcome').text("Computer Says: " + losePhrases[Math.floor(8 * Math.random())]);
	}
    
    // reset user choice
    Image('blank', 500, -40);
    Image('blank', 500, -70);
    // reset comp choice
    Image('blank', 650, -40);
    Image('blank', 650, -70);
    
    var RPS = ["rock", "paper", "scissor"]; // list of RPS options
    for (i = 0; i < 3; i++) {
        if (getChoice(userChoice) == RPS[i]) { 
            d3.selectAll('.you').text("You chose: " + Image(RPS[i], 500, 0));
        }
    }
    for (i = 0; i < 3; i++) {
        if (getChoice(compChoice) == RPS[i]) {
            d3.selectAll('.computer').text("Computer chose: " + Image(RPS[i], 650, 0));
        }  
    }
    
    // Update level board as necessary
    Medal(wins);
}

/**
Following two functions are assigned to each square and basically just increase/decrease the size of the squares on hover.
*/

function mouseHover(){
	d3.select(this)
			.transition()
			.attr('width', '110')
			.attr('height', '110')
			.attr('stroke', 'none');
}

function mouseOut(){
	d3.select(this)
			.transition()
			.attr('width', '100')
			.attr('height', '100')
			.attr('stroke', 'none');
}


//RNG function
function computerChoice(){
	return Math.floor(3 * Math.random()); // randomly choose a number between 0 and 2 for the computer's choice
}

// displays the options as well as user/computer choices
// parameters: choice = rock, paper, scissor; x = x data; y = y data
function Image(choice, x, y) {
    
    RPS = ['rock', 'paper', 'scissor'];
    links = ["https://img.clipartfest.com/201616f9cdd7deb314215b1be524d2a2_clipart-alpine-landscape-rock-rock-clipart_800-534.png", "https://www.rocknwater.com/wp-content/uploads/icon-paper-document-fold-redirect-pdf.png", "http://www.clipartbest.com/cliparts/KTn/Xj6/KTnXj6Mgc.png"]; // links are in the order RPS

    for (i = 0; i < 3; i++) {
        if (choice == RPS[i]) {
            var img = board.append("svg:image")
            //var img = board.selectAll(("choice")).data("links").enter()
             //   .add(("choice"))
                .attr("xlink:href", links[i])
                .attr("width", 100)
                .attr("height", 100)
                .attr("x", x)
                .attr("y",y)
                .on("mouseover", mouseHover)
                .on("mouseout", mouseOut);
        }   
    } 
    
    // blank reset
    if (choice == 'blank') {
        var img = board.append("svg:image")
            .attr("xlink:href", "http://www.yarwoodleather.com/wp-content/uploads/2016/12/Aneurin-Grey.jpg")
            .attr("width", 100)
            .attr("height", 200)
            .attr("x", x)
            .attr("y",y);
    }
    
    return choice;
}

function Medal(wins) {
    // displays the player's current level as text as well as a badge
    
    numWins = [0, 4, 8, 12];
    links = ["http://www.aapexshow.com/2017//custom/images/bronze.png", "https://static1.squarespace.com/static/56dc3f9cb654f9876576bab7/t/58af37a5d1758ef40fffbfc6/1487878063862/", "http://www.aapexshow.com/2017//custom/images/gold.png", "https://i2.wp.com/wordsowers.com/wp-content/uploads/2017/01/platinum-level.png?fit=562%2C563"]; // in the order BSGP
    
    for (i = 0; i < 4; i++) {
        if (wins >= numWins[i]) {
            // blank reset
            board.append("svg:image")
                .attr("xlink:href", "http://www.yarwoodleather.com/wp-content/uploads/2016/12/Aneurin-Grey.jpg")
                .attr("width", 100)
                .attr("height", 100)
                .attr("x", 870)
                .attr("y",10);
            // new level icon
            board.append("svg:image")
                .attr("xlink:href", links[i])
                .attr("width", 100)
                .attr("height", 100)
                .attr("x", 870)
                .attr("y",10);
        }
    } 
}

function winner(userInput, compInput){
	if(userInput == 0 && compInput == 2) return 1; // R > S
    if(userInput == 1 && compInput == 0) return 1; // P > R
    if(userInput == 2 && compInput == 1) return 1; // S > P
    if(userInput == 0 && compInput == 1) return 0; // R < P
    if(userInput == 1 && compInput == 2) return 0; // P < S
    if(userInput == 2 && compInput == 0) return 0; // S < R
	if(compInput == userInput) return -1;	
}

function getChoice(value){
	if(value == 0) return 'rock';
	if(value == 1) return 'paper';
	if(value == 2) return 'scissor';
}
            </script>                                               
{{=BEAUTIFY(response._vars)}}
</body>
